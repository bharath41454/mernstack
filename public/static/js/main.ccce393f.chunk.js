(this["webpackJsonpmern-demo"]=this["webpackJsonpmern-demo"]||[]).push([[0],[,,,,,,,,,,,,function(e,t,n){"use strict";n(1);var a=n(10),c=(n(39),n(0));t.a=function(e){return e.href?Object(c.jsx)("a",{className:"button button--".concat(e.size||"default"," ").concat(e.inverse&&"button--inverse"," ").concat(e.danger&&"button--danger"),href:e.href,children:e.children}):e.to?Object(c.jsx)(a.b,{to:e.to,exact:e.exact,className:"button button--".concat(e.size||"default"," ").concat(e.inverse&&"button--inverse"," ").concat(e.danger&&"button--danger"),children:e.children}):Object(c.jsx)("button",{className:"button button--".concat(e.size||"default"," ").concat(e.inverse&&"button--inverse"," ").concat(e.danger&&"button--danger"),type:e.type,onClick:e.onClick,disabled:e.disabled,children:e.children})}},,,function(e,t,n){"use strict";n(1),n(52);var a=n(0);t.a=function(e){return Object(a.jsx)("div",{className:"".concat(e.asOverlay&&"loading-spinner__overlay"),children:Object(a.jsx)("div",{className:"lds-dual-ring"})})}},,function(e,t,n){"use strict";n(1);var a=n(8),c=n.n(a),r=(n(50),n(0));t.a=function(e){return c.a.createPortal(Object(r.jsx)("div",{className:"backdrop",onClick:e.onClick}),document.getElementById("backdrop-hook"))}},,,,,,,function(e,t,n){"use strict";n(1),n(55);var a=n(0);t.a=function(e){return Object(a.jsx)("div",{className:"card ".concat(e.className),style:e.style,children:e.children})}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(14),c=n.n(a),r=n(16),i=n(4),s=n(1),o=function(){var e=Object(s.useState)(!1),t=Object(i.a)(e,2),n=t[0],a=t[1],o=Object(s.useState)(),l=Object(i.a)(o,2),u=l[0],d=l[1],j=Object(s.useRef)([]),b=Object(s.useCallback)(function(){var e=Object(r.a)(c.a.mark((function e(t){var n,r,i,s,o,l,u=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:"GET",r=u.length>2&&void 0!==u[2]?u[2]:null,i=u.length>3&&void 0!==u[3]?u[3]:{},a(!0),s=new AbortController,j.current.push(s),e.prev=6,e.next=9,fetch(t,{method:n,body:r,headers:i,signal:s.signal});case 9:return o=e.sent,e.next=12,o.json();case 12:if(l=e.sent,j.current=j.current.filter((function(e){return e!==s})),o.ok){e.next=16;break}throw new Error(l.message);case 16:return a(!1),e.abrupt("return",l);case 20:throw e.prev=20,e.t0=e.catch(6),d(e.t0.message),a(!1),e.t0;case 25:case"end":return e.stop()}}),e,null,[[6,20]])})));return function(t){return e.apply(this,arguments)}}(),[]);return Object(s.useEffect)((function(){return function(){j.current.forEach((function(e){return e.abort()}))}}),[]),{isLoading:n,error:u,sendRequest:b,clearError:function(){d(null)}}}},function(e,t,n){"use strict";var a=n(1),c=n.n(a),r=n(6),i=n(8),s=n.n(i),o=n(60),l=n(17),u=(n(56),n(0)),d=function(e){var t=Object(u.jsxs)("div",{className:"modal ".concat(e.className),style:e.style,children:[Object(u.jsx)("header",{className:"modal__header ".concat(e.className),children:Object(u.jsx)("h2",{children:e.header})}),Object(u.jsx)("form",{onSubmit:e.onSubmit?e.onSubmit:function(e){return e.preventDefault()},children:Object(u.jsx)("div",{className:"modal__content ".concat(e.contentClass),children:e.children})}),Object(u.jsx)("footer",{className:"modal__footer ".concat(e.footerClass),children:e.footer})]});return s.a.createPortal(t,document.getElementById("modal-hook"))},j=function(e){return Object(u.jsxs)(c.a.Fragment,{children:[e.show&&Object(u.jsx)(l.a,{onClick:e.onCancel}),Object(u.jsx)(o.a,{in:e.show,mountOnEnter:!0,unmountOnExit:!0,timeout:200,classNames:"modal",children:Object(u.jsx)(d,Object(r.a)({},e))})]})},b=n(12);t.a=function(e){return Object(u.jsx)(j,{onCancel:e.onClear,header:"An Error Occurred!",show:!!e.error,footer:Object(u.jsx)(b.a,{onClick:e.onClear,children:"Okay"}),children:Object(u.jsx)("p",{children:e.error})})}},,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},,function(e,t,n){},,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a,c=n(1),r=n.n(c),i=n(8),s=n.n(i),o=(n(35),n(2)),l=n(10),u=(n(36),n(4)),d=(n(37),n(0)),j=function(e){return Object(d.jsx)("header",{className:"main-header",children:e.children})},b=Object(c.createContext)({isLoggedIn:!1,userId:null,token:null,login:function(){},logout:function(){}}),O=n(12),p=(n(48),function(e){var t=Object(c.useContext)(b);return Object(d.jsxs)("ul",{className:"nav-links",children:[Object(d.jsx)("li",{children:Object(d.jsx)(l.c,{to:"/",exact:!0,children:"All Users"})}),t.isLoggedIn&&Object(d.jsx)("li",{children:Object(d.jsx)(l.c,{to:"/".concat(t.userId,"/places"),children:"My Places"})}),t.isLoggedIn&&Object(d.jsx)("li",{children:Object(d.jsx)(l.c,{to:"/places/new",children:"Add Places"})}),!t.isLoggedIn&&Object(d.jsx)("li",{children:Object(d.jsx)(l.c,{to:"/auth",children:"Autheticate"})}),t.isLoggedIn&&Object(d.jsx)("li",{children:Object(d.jsx)("button",{onClick:t.logout,children:"Logout"})})]})}),h=n(60),m=(n(49),function(e){var t=Object(d.jsx)(h.a,{in:e.show,timeout:200,classNames:"slide-in-left",mountOnEnter:!0,unmountOnExit:!0,children:Object(d.jsx)("aside",{className:"side-drawer",onClick:e.onClick,children:e.children})});return s.a.createPortal(t,document.getElementById("drawer-hook"))}),f=n(17),x=(n(51),function(e){var t=Object(c.useState)(!1),n=Object(u.a)(t,2),a=n[0],i=n[1],s=function(){i(!1)};return Object(d.jsxs)(r.a.Fragment,{children:[a&&Object(d.jsx)(f.a,{onClick:s}),Object(d.jsx)(m,{show:a,onClick:s,children:Object(d.jsx)("nav",{className:"main-navigation__drawer-nav",children:Object(d.jsx)(p,{})})}),Object(d.jsxs)(j,{children:[Object(d.jsxs)("button",{className:"main-navigation__menu-btn",onClick:function(){i(!0)},children:[Object(d.jsx)("span",{}),Object(d.jsx)("span",{}),Object(d.jsx)("span",{})]}),Object(d.jsx)("h1",{className:"main-navigation__title",children:Object(d.jsx)(l.b,{to:"/",children:"Your places"})}),Object(d.jsx)("nav",{className:"main-navigation__header-nav",children:Object(d.jsx)(p,{})})]})]})}),v=n(15),g=n(14),y=n.n(g),C=n(16),S=n(6),N=n(28),k="REQUIRE",w="MINLENGTH",E="MAXLENGTH",I="EMAIL",T=function(e,t){var n,a=!0,c=Object(N.a)(t);try{for(c.s();!(n=c.n()).done;){var r=n.value;r.type===k&&(a=a&&e.trim().length>0),r.type===w&&(a=a&&e.trim().length>=r.val),r.type===E&&(a=a&&e.trim().length<=r.val),"MIN"===r.type&&(a=a&&+e>=r.val),"MAX"===r.type&&(a=a&&+e<=r.val),r.type===I&&(a=a&&/^\S+@\S+\.\S+$/.test(e))}}catch(i){c.e(i)}finally{c.f()}return a},_=(n(54),function(e,t){switch(t.type){case"CHANGE":return Object(S.a)(Object(S.a)({},e),{},{value:t.val,isValid:T(t.val,t.validators)});case"TOUCH":return Object(S.a)(Object(S.a)({},e),{},{isTouched:!0});default:return e}}),P=function(e){var t={value:e.initialValue||"",isTouched:!1,isValid:e.initialValid||!1},n=Object(c.useReducer)(_,t),a=Object(u.a)(n,2),r=a[0],i=a[1],s=e.id,o=e.onInput,l=r.value,j=r.isValid;Object(c.useEffect)((function(){o(s,l,j)}),[s,l,j,o]);var b=function(t){i({type:"CHANGE",val:t.target.value,validators:e.validators})},O=function(){i({type:"TOUCH"})},p="input"===e.element?Object(d.jsx)("input",{id:e.id,type:e.type,placeholder:e.placeholder,onChange:b,onBlur:O,value:r.value}):Object(d.jsx)("textarea",{id:e.id,rows:e.rows||3,onChange:b,onBlur:O,value:r.value});return Object(d.jsxs)("div",{className:"form-control ".concat(!r.isValid&&r.isTouched&&"form-control--invalid"),children:[Object(d.jsx)("label",{htmlFor:e.id,children:e.label}),p,!r.isValid&&r.isTouched&&Object(d.jsx)("p",{children:e.errorText})]})},D=n(24),V=n(26),L=(n(57),function(e){var t=Object(c.useRef)(),n=Object(c.useState)(),a=Object(u.a)(n,2),i=a[0],s=a[1],o=Object(c.useState)(),l=Object(u.a)(o,2),j=l[0],b=l[1],p=Object(c.useState)(!1),h=Object(u.a)(p,2),m=h[0],f=h[1];Object(c.useEffect)((function(){if(i){var e=new FileReader;e.onload=function(){b(e.result)},e.readAsDataURL(i)}}),[i]);return Object(d.jsx)(r.a.Fragment,{children:Object(d.jsxs)("div",{className:"form-control",children:[Object(d.jsx)("input",{type:"file",ref:t,id:e.id,style:{display:"none"},className:" ",accept:".jpg,.png,.jpeg",onChange:function(t){var n,a=t.target,c=m;a.files&&1===a.files.length?(n=a.files[0],s(n),f(!0),c=!0):(f(!1),c=!1),e.onInput(e.id,n,c)}}),Object(d.jsxs)("div",{className:"image-upload ".concat(e.center&&"center"),children:[Object(d.jsxs)("div",{className:"image-upload__preview",children:[j&&Object(d.jsx)("img",{src:j,alt:"Preview"}),!j&&Object(d.jsx)("p",{children:"Please pick an image."})]}),Object(d.jsx)(O.a,{type:"button",onClick:function(){t.current.click()},children:"Pick Image"})]}),!m&&Object(d.jsx)("p",{children:e.errorText})]})})}),A=n(18),R=function(e,t){switch(t.type){case"INPUT_CHANGE":var n=!0;for(var a in e.inputs)e.inputs[a]&&(n=a===t.inputId?n&&t.isValid:n&&e.inputs[a].isValid);return Object(S.a)(Object(S.a)({},e),{},{inputs:Object(S.a)(Object(S.a)({},e.inputs),{},Object(A.a)({},t.inputId,{value:t.value,isValid:t.isValid})),isValid:n});case"SET_DATA":return{inputs:t.inputs,isValid:t.isValid};default:return e}},F=(n(58),n(25)),U=function(){var e,t=Object(c.useContext)(b),n=Object(c.useState)(!0),a=Object(u.a)(n,2),i=a[0],s=a[1],o=Object(F.a)(),l=o.isLoading,j=o.error,p=o.sendRequest,h=o.clearError,m=function(e,t){var n={inputs:e,isValid:t},a=Object(c.useReducer)(R,n),r=Object(u.a)(a,2),i=r[0],s=r[1];return[i,Object(c.useCallback)((function(e,t,n){s({type:"INPUT_CHANGE",value:t,isValid:n,inputId:e})}),[]),Object(c.useCallback)((function(e,t){s({type:"SET_DATA",inputs:e,formIsValid:t})}),[])]}({email:{value:"",isValid:!1},password:{value:"",isValid:!1}},!1),f=Object(u.a)(m,3),x=f[0],g=f[1],N=f[2],E=function(){var e=Object(C.a)(y.a.mark((function e(n){var a,c,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),!i){e.next=14;break}return e.prev=2,e.next=5,p("".concat(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).BACKEND_URL,"users/login"),"POST",JSON.stringify({email:x.inputs.email.value,password:x.inputs.password.value}),{"Content-Type":"application/json"});case 5:a=e.sent,t.login(a.userId,a.token),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0);case 12:e.next=29;break;case 14:return e.prev=14,(c=new FormData).append("email",x.inputs.email.value),c.append("name",x.inputs.name.value),c.append("password",x.inputs.password.value),c.append("image",x.inputs.image.value),e.next=22,p("".concat(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).BACKEND_URL,"users/signup"),"POST",c);case 22:r=e.sent,t.login(r.userId,r.token),e.next=29;break;case 26:e.prev=26,e.t1=e.catch(14),console.error(e.t1);case 29:case"end":return e.stop()}}),e,null,[[2,9],[14,26]])})));return function(t){return e.apply(this,arguments)}}();return Object(d.jsxs)(r.a.Fragment,{children:[Object(d.jsx)(V.a,{error:j,onClear:h}),Object(d.jsxs)(D.a,{className:"authentication",children:[l&&Object(d.jsx)(v.a,{asOverlay:!0}),Object(d.jsx)("h2",{children:"Login Required"}),Object(d.jsx)("hr",{}),Object(d.jsxs)("form",{onSubmit:E,children:[!i&&Object(d.jsxs)(r.a.Fragment,{children:[Object(d.jsx)(P,{element:"input",id:"name",type:"text",label:"Your Name",validators:[{type:k}],errorText:"Please enter a name",onInput:g}),Object(d.jsx)(L,{id:"image",center:!0,onInput:g,errorText:"Please provide an image"})]}),Object(d.jsx)(P,{id:"email",element:"input",type:"email",label:"E-mail",placeholder:"enter email",validators:[{type:I}],errorText:"Please enter valid email",onInput:g}),Object(d.jsx)(P,{id:"password",element:"input",type:"password",label:"Password",placeholder:"enter password",validators:[(e=6,{type:w,val:e})],errorText:"Please enter valid password",onInput:g}),Object(d.jsx)(O.a,{type:"submit",inverse:!0,disabled:!x.isValid,children:i?"Login":"SIGNUP"})]}),Object(d.jsx)(O.a,{type:"submit",inverse:!0,onClick:function(){i?N(Object(S.a)(Object(S.a)({},x.inputs),{},{name:{value:"",isValid:!1},image:{value:null,isValid:!1}}),!1):N(Object(S.a)(Object(S.a)({},x.inputs),{},{name:void 0,image:void 0}),x.inputs.email.isValid&&x.inputs.password.isValid),s((function(e){return!e}))},children:i?"Switch to sign up":"Switch to Login"})]})]})},H=r.a.lazy((function(){return n.e(3).then(n.bind(null,65))})),B=r.a.lazy("./places/pages/NewPlaces"),G=r.a.lazy("./places/pages/UserPlaces"),K=r.a.lazy("./places/pages/UpdatePlace"),z=function(){var e,t=function(){var e=Object(c.useState)(null),t=Object(u.a)(e,2),n=t[0],r=t[1],i=Object(c.useState)(!1),s=Object(u.a)(i,2),o=s[0],l=s[1],d=Object(c.useState)(),j=Object(u.a)(d,2),b=j[0],O=j[1],p=Object(c.useCallback)((function(e,t,n){r(t),l(e);var a=n||new Date((new Date).getTime()+36e5);O(a),localStorage.setItem("userData",JSON.stringify({userId:e,token:t,expiration:a.toISOString()}))}),[]),h=Object(c.useCallback)((function(){r(null),localStorage.removeItem("userData"),l(null),O(null)}),[]);return Object(c.useEffect)((function(){if(n&&b){var e=b.getTime()-(new Date).getTime();a=setTimeout(h,e)}else clearTimeout(a)}),[n,h,b]),Object(c.useEffect)((function(){var e=JSON.parse(localStorage.getItem("userData"));e&&e.token&&new Date(e.expiration)>new Date&&p(e.userId,e.token,new Date(e.expiration))}),[p]),{token:n,userId:o,login:p,logout:h}}(),n=t.token,i=t.userId,s=t.login,j=t.logout;return e=n?Object(d.jsxs)(o.d,{children:[Object(d.jsx)(o.b,{path:"/",component:H,exact:!0}),Object(d.jsx)(o.b,{path:"/places/new",component:B,exact:!0}),Object(d.jsx)(o.b,{path:"/places/:placeId",component:K}),Object(d.jsx)(o.b,{path:"/:userId/places",component:G,exact:!0}),Object(d.jsx)(o.a,{to:"/",component:H})]}):Object(d.jsxs)(o.d,{children:[Object(d.jsx)(o.b,{path:"/",component:H,exact:!0}),Object(d.jsx)(o.b,{path:"/:userId/places",component:G,exact:!0}),Object(d.jsx)(o.b,{path:"/auth",component:U,exact:!0}),Object(d.jsx)(o.a,{to:"/auth",component:U})]}),Object(d.jsx)(r.a.Fragment,{children:Object(d.jsx)(b.Provider,{value:{isLoggedIn:!!n,token:n,userId:i,login:s,logout:j},children:Object(d.jsxs)(l.a,{children:[Object(d.jsx)(x,{}),Object(d.jsx)("main",{children:Object(d.jsx)(c.Suspense,{fallback:Object(d.jsx)("div",{className:"center",children:Object(d.jsx)(v.a,{})}),children:e})})]})})})},M=function(e){e&&e instanceof Function&&n.e(4).then(n.bind(null,64)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),r(e),i(e)}))};s.a.render(Object(d.jsx)(r.a.StrictMode,{children:Object(d.jsx)(z,{})}),document.getElementById("root")),M()}],[[59,1,2]]]);
//# sourceMappingURL=main.ccce393f.chunk.js.map